<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage &mdash; Beaker  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Application" href="application.html" />
    <link rel="prev" title="Beaker" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Beaker
            <img src="_static/beaker.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decorators">Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#state-management">State Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-default-values">Parameter Default Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#precompiles">Precompiles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="lsig.html">Logic Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="application_client.html">Application Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="sandbox.html">Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">State</a></li>
<li class="toctree-l1"><a class="reference internal" href="precompile.html">Precompile</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorators.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Beaker</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h1>
<section id="tutorial">
<span id="id1"></span><h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial assumes you’ve already installed the <a class="reference external" href="https://github.com/algorand/sandbox">sandbox</a> and have it running.</p>
</div>
<p>Lets write a simple calculator app.  <a class="reference external" href="https://github.com/algorand-devrel/beaker/blob/master/examples/simple/calculator.py">Full source here</a>.</p>
<p>First, create a class to represent our application as a subclass of the beaker <cite>Application</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beaker</span> <span class="kn">import</span> <span class="n">Application</span>

<span class="k">class</span> <span class="nc">Calculator</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This is a full application, though it doesn’t do much.</p>
<p>Instantiate it and take a look at some of the resulting fields.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>

</pre></div>
</div>
<p>Nice!  This is already enough to provide the TEAL programs and ABI specification.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Application.dump</span></code> method can be used to write the <code class="docutils literal notranslate"><span class="pre">approval.teal</span></code>, <code class="docutils literal notranslate"><span class="pre">clear.teal</span></code>, <code class="docutils literal notranslate"><span class="pre">contract.json</span></code>, and <code class="docutils literal notranslate"><span class="pre">application.json</span></code> to the local file system.</p>
</div>
<p>Lets add some methods to be handled by an incoming <a class="reference external" href="https://developer.algorand.org/docs/get-details/transactions/transactions/#application-call-transaction">ApplicationCallTransaction</a>.
We can do this by tagging a <a class="reference external" href="https://pyteal.readthedocs.io/en/stable/api.html#pyteal.ABIReturnSubroutine">PyTeal ABI</a> method with with the <a class="reference internal" href="decorators.html#external"><span class="std std-ref">external</span></a> decorator.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Calculator</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a and b, return the result&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply a and b, return the result&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract b from a, return the result&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide a by b, return the result&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;external</span></code> decorator adds an ABI method to our application and includes it in the routing logic for handling an ABI call.</p>
<p>The python method must return an <code class="docutils literal notranslate"><span class="pre">Expr</span></code> of some kind, invoked when the external is called.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">self</span></code> may be omitted if the method does not need to access any instance variables. Class variables or methods may be accessed through the class name like <code class="docutils literal notranslate"><span class="pre">MySickApp.do_thing(data)</span></code></p>
</div>
<p>Lets now deploy and call our contract using an <a class="reference internal" href="application_client.html#id1"><span class="std std-ref">ApplicationClient</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Here we use `sandbox` but beaker.client.api_providers can also be used</span>
    <span class="c1"># with something like ``AlgoNode(Network.TestNet).algod()``</span>
    <span class="n">algod_client</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">get_algod_client</span><span class="p">()</span>

    <span class="n">acct</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">get_accounts</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c1"># Create an Application client containing both an algod client and app</span>
    <span class="n">app_client</span> <span class="o">=</span> <span class="n">ApplicationClient</span><span class="p">(</span>
        <span class="n">client</span><span class="o">=</span><span class="n">algod_client</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="n">Calculator</span><span class="p">(),</span> <span class="n">signer</span><span class="o">=</span><span class="n">acct</span><span class="o">.</span><span class="n">signer</span>
    <span class="p">)</span>

    <span class="c1"># Create the application on chain, set the app id for the app client</span>
    <span class="n">app_id</span><span class="p">,</span> <span class="n">app_addr</span><span class="p">,</span> <span class="n">txid</span> <span class="o">=</span> <span class="n">app_client</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created App with id: </span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s2"> and address addr: </span><span class="si">{</span><span class="n">app_addr</span><span class="si">}</span><span class="s2"> in tx: </span><span class="si">{</span><span class="n">txid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Thats it!</p>
<p>To summarize, we:</p>
<blockquote>
<div><ul>
<li><dl class="simple">
<dt>Wrote an application using Beaker and PyTeal</dt><dd><p>By subclassing <code class="docutils literal notranslate"><span class="pre">Application</span></code> and adding an <code class="docutils literal notranslate"><span class="pre">external</span></code> method</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Compiled it to TEAL</dt><dd><p>Done automatically by the <code class="docutils literal notranslate"><span class="pre">Application</span></code> class, and PyTeal’s <code class="docutils literal notranslate"><span class="pre">Router.compile</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Assembled the TEAL to binary</dt><dd><p>Done automatically by the <code class="docutils literal notranslate"><span class="pre">ApplicationClient</span></code> by sending the TEAL to the algod <code class="docutils literal notranslate"><span class="pre">compile</span></code> endpoint</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Deployed the application on-chain</dt><dd><p>Done by invoking the <code class="docutils literal notranslate"><span class="pre">app_client.create</span></code>, which submits an ApplicationCallTransaction including our binary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once created, subsequent calls to the app_client are directed to the <code class="docutils literal notranslate"><span class="pre">app_id</span></code>.
The constructor may also be passed an app_id directly if one is already deployed.</p>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>Called the method we defined</dt><dd><p>Using <code class="docutils literal notranslate"><span class="pre">app_client.call</span></code>, passing the method defined in our class and args the method specified (by name).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The args passed must match the type of the method (i.e. don’t pass a string when it wants an int).</p>
</div>
<p>The result contains the parsed <code class="docutils literal notranslate"><span class="pre">return_value</span></code> which is a python native type that mirrors the return type of the ABI method.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="decorators">
<span id="use-decorators"></span><h2>Decorators<a class="headerlink" href="#decorators" title="Permalink to this heading"></a></h2>
<p>Above, we used the decorator <code class="docutils literal notranslate"><span class="pre">&#64;external</span></code> to mark a method as being exposed in the ABI and available to be called from off-chain.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;external</span></code> decorator can take parameters to change how it may be called or what accounts may call it, see examples <a class="reference internal" href="decorators.html#external"><span class="std std-ref">here</span></a>.</p>
<p>Other decorators include <a class="reference internal" href="decorators.html#internal-methods"><span class="std std-ref">&#64;internal</span></a> which marks the method as being callable only from inside the application or with one of the <a class="reference internal" href="decorators.html#oncomplete-externals"><span class="std std-ref">OnComplete</span></a> handlers (e.g. <code class="docutils literal notranslate"><span class="pre">create</span></code>, <code class="docutils literal notranslate"><span class="pre">opt_in</span></code>, etc…)</p>
</section>
<section id="state-management">
<span id="manage-state"></span><h2>State Management<a class="headerlink" href="#state-management" title="Permalink to this heading"></a></h2>
<p>Beaker provides a way to define state values as class variables and use them throughout our program. This is a convenient way to encapsulate functionality associated with some state values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Throughout the examples, we tend to mark State Values as <code class="docutils literal notranslate"><span class="pre">Final[...]</span></code>, this is solely for good practice and has no effect on the output of the program.</p>
</div>
<p>Lets write a new app with Application State (or <a class="reference external" href="https://developer.algorand.org/docs/get-details/dapps/smart-contracts/apps/#modifying-state-in-smart-contract">Global State</a> in Algorand parlance) to our Application.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CounterApp</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>

    <span class="n">counter</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">ApplicationStateValue</span><span class="p">]</span> <span class="o">=</span> <span class="n">ApplicationStateValue</span><span class="p">(</span>
        <span class="n">stack_type</span><span class="o">=</span><span class="n">TealType</span><span class="o">.</span><span class="n">uint64</span><span class="p">,</span>
        <span class="n">descr</span><span class="o">=</span><span class="s2">&quot;A counter for showing how to use application state&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@create</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_application_state</span><span class="p">()</span>

    <span class="nd">@external</span><span class="p">(</span><span class="n">authorize</span><span class="o">=</span><span class="n">Authorize</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="n">Global</span><span class="o">.</span><span class="n">creator_address</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;increment the counter&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Seq</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="n">Int</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@external</span><span class="p">(</span><span class="n">authorize</span><span class="o">=</span><span class="n">Authorize</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="n">Global</span><span class="o">.</span><span class="n">creator_address</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">decrement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decrement the counter&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Seq</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">-</span> <span class="n">Int</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span>
        <span class="p">)</span>

</pre></div>
</div>
<p>We’ve added an <a class="reference internal" href="state.html#application-state-value"><span class="std std-ref">ApplicationStateValue</span></a> attribute to our class with several configuration options and we can reference it by name throughout our application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The base <code class="docutils literal notranslate"><span class="pre">Application</span></code> class has several externals pre-defined, including <code class="docutils literal notranslate"><span class="pre">create</span></code> which performs <code class="docutils literal notranslate"><span class="pre">ApplicationState</span></code> initialization for us, setting the keys to default values.</p>
</div>
<p>You may also define state values for applications, called <a class="reference internal" href="state.html#account-state"><span class="std std-ref">AccountState</span></a> (or Local storage) and even allow for reserved state keys.</p>
<p>For more example usage see the example <a class="reference internal" href="state.html#state-example"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="inheritance">
<span id="id2"></span><h2>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this heading"></a></h2>
<p>What about extending our Application with some other functionality?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beaker.decorators</span> <span class="kn">import</span> <span class="n">external</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">op_up</span> <span class="kn">import</span> <span class="n">OpUp</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.op_up</span> <span class="kn">import</span> <span class="n">OpUp</span>


<span class="k">class</span> <span class="nc">ExpensiveApp</span><span class="p">(</span><span class="n">OpUp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do expensive work to demonstrate inheriting from OpUp&quot;&quot;&quot;</span>

    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">hash_it</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
        <span class="n">iters</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Uint64</span><span class="p">,</span>
        <span class="n">opup_app</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Application</span> <span class="o">=</span> <span class="n">OpUp</span><span class="o">.</span><span class="n">opup_app_id</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">StaticBytes</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="mi">32</span><span class="p">]],</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">Seq</span><span class="p">(</span>
            <span class="n">Assert</span><span class="p">(</span><span class="n">opup_app</span><span class="o">.</span><span class="n">application_id</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">opup_app_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_opup</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="mi">255</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">current</span> <span class="o">:=</span> <span class="n">ScratchVar</span><span class="p">())</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span>
            <span class="n">For</span><span class="p">(</span>
                <span class="p">(</span><span class="n">i</span> <span class="o">:=</span> <span class="n">ScratchVar</span><span class="p">())</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
</pre></div>
</div>
<p>Here we subclassed the <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> contract which provides functionality to create a new Application on chain and store its app id for subsequent calls to increase budget.</p>
<p>We inherit the methods and class variables that <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> defined, allowing us to encapsulate and compose behavior.</p>
<p>Also note that the <code class="docutils literal notranslate"><span class="pre">opup_app</span></code> argument specifies a default value. This is a bit of magic that serves only to produce a hint for the caller in the resulting Application Spec.</p>
</section>
<section id="parameter-default-values">
<span id="parameter-default"></span><h2>Parameter Default Values<a class="headerlink" href="#parameter-default-values" title="Permalink to this heading"></a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> example above, the argument <code class="docutils literal notranslate"><span class="pre">opup_app</span></code> should be the id of the application that we use to increase our budget via inner app calls.
This value should not change frequently, if at all, but is still required to be passed by the caller so we may <strong>use</strong> it in our logic, namely to execute an application call against it.</p>
<p>By specifying the default value of the argument in the method signature, we can communicate to the caller, through the hints of the Application Spec, what the value <strong>should</strong> be.</p>
<p>Options for default arguments are:</p>
<ul class="simple">
<li><p>A constant: one of <code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">Bytes</span> <span class="pre">|</span> <span class="pre">Int</span></code></p></li>
<li><p>State Values: one of <code class="docutils literal notranslate"><span class="pre">ApplicationStateValue</span> <span class="pre">|</span> <span class="pre">AccountStateValue</span></code></p></li>
<li><p>A read-only ABI method: a method defined to produce some more complex value than a state value or constant would be able to produce.</p></li>
</ul>
<p>The result of specifying the default value here is that we can call the method, omitting the <cite>opup_app</cite> argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">app_client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">hash_it</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;hashme&quot;</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>When invoked, the <code class="docutils literal notranslate"><span class="pre">ApplicationClient</span></code> consults the method definition to check that all the expected arguments are passed.
If it finds that an argument is not passed, it will check the hints for a default argument for the method that may be used directly (constant) or resolved (need to look it up on chain or call method).
Upon finding a resolvable it will look up the state value, call the method. The resulting value is passed in for argument to the application call.</p>
</section>
<section id="precompiles">
<h2>Precompiles<a class="headerlink" href="#precompiles" title="Permalink to this heading"></a></h2>
<p>Often an app developer needs to have the assembled binary of a program available at contract runtime. One way to get this binary is to use the <code class="docutils literal notranslate"><span class="pre">Precompile</span></code> feature.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> example above, the <code class="docutils literal notranslate"><span class="pre">ExpensiveApp</span></code> inherits from the <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> app. The <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> app contains an <code class="docutils literal notranslate"><span class="pre">AppPrecompile</span></code> for the target app we’d like to call
when we make opup requests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TargetApp</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple app that allows the creator to call `opup` in order to increase its opcode budget&quot;&quot;&quot;</span>

    <span class="nd">@external</span><span class="p">(</span><span class="n">authorize</span><span class="o">=</span><span class="n">Authorize</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="n">Global</span><span class="o">.</span><span class="n">creator_address</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">opup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Approve</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">OpUp</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;OpUp creates a &quot;target&quot; application to make opup calls against in order to increase our opcode budget.&quot;&quot;&quot;</span>

    <span class="c1">#: The app to be created to receiver opup requests</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">AppPrecompile</span> <span class="o">=</span> <span class="n">AppPrecompile</span><span class="p">(</span><span class="n">TargetApp</span><span class="p">())</span>

</pre></div>
</div>
<p>The inclusion of a <code class="docutils literal notranslate"><span class="pre">Precompile</span></code> prevents building the TEAL until its been fully compiled to assembled binary but we can still reference it in our Application.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">OpUp</span></code> Application defines a method to create the target application by referencing the <code class="docutils literal notranslate"><span class="pre">AppPrecompile's</span></code> approval/clear binary attribute which contains the assembled binary
for the target Application as a <code class="docutils literal notranslate"><span class="pre">Bytes</span></code> Expression.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@internal</span><span class="p">(</span><span class="n">TealType</span><span class="o">.</span><span class="n">none</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_opup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;internal method to create the target application&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Seq</span><span class="p">(</span>
            <span class="n">InnerTxnBuilder</span><span class="o">.</span><span class="n">Begin</span><span class="p">(),</span>
            <span class="n">InnerTxnBuilder</span><span class="o">.</span><span class="n">SetFields</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">TxnField</span><span class="o">.</span><span class="n">type_enum</span><span class="p">:</span> <span class="n">TxnType</span><span class="o">.</span><span class="n">ApplicationCall</span><span class="p">,</span>
                    <span class="n">TxnField</span><span class="o">.</span><span class="n">approval_program</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">approval</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
                    <span class="n">TxnField</span><span class="o">.</span><span class="n">clear_state_program</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">clear</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
                    <span class="n">TxnField</span><span class="o">.</span><span class="n">fee</span><span class="p">:</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="n">InnerTxnBuilder</span><span class="o">.</span><span class="n">Submit</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opup_app_id</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">InnerTxn</span><span class="o">.</span><span class="n">created_application_id</span><span class="p">()),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Another situations where a <code class="docutils literal notranslate"><span class="pre">Precompile</span></code> is useful is when validating the logic of a LogicSignature.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">offload_compute</span></code> example, we check to make sure that the hash of the signer is the LogicSignature we’re expecting so that we’re sure it is doing “the right thing”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">check_eth_sig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">:</span> <span class="n">HashValue</span><span class="p">,</span> <span class="n">signature</span><span class="p">:</span> <span class="n">Signature</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">String</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">Seq</span><span class="p">(</span>
            <span class="c1"># The precompiled lsig should have its address and binary available</span>
            <span class="c1"># here so we can use it to make sure we&#39;ve been called</span>
            <span class="c1"># with the correct lsig</span>
            <span class="n">Assert</span><span class="p">(</span><span class="n">Txn</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">verifier</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">hash</span><span class="p">()),</span>
            <span class="n">output</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;lsig validated&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Additionally, if the LogicSignature has one or more <code class="docutils literal notranslate"><span class="pre">TemplateVariables</span></code> specified, the <code class="docutils literal notranslate"><span class="pre">template_hash</span></code> function may be used by passing arguments that should be populated into the templated <code class="docutils literal notranslate"><span class="pre">LogicSignature</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@external</span>
    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signer_address</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">Address</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">abi</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">Signature</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Assert</span><span class="p">(</span>
            <span class="n">Txn</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_checker</span><span class="o">.</span><span class="n">logic</span><span class="o">.</span><span class="n">template_hash</span><span class="p">(</span><span class="n">signer_address</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="p">)</span>

</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Beaker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="application.html" class="btn btn-neutral float-right" title="Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Algorand.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>